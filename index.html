<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Ear Training</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>

      .button_icon {
        background-color: white;
        border: none;
        font-weight: bold;
      }
      .material-symbols-outlined {
        font-size: 60px;
        cursor: pointer;
        font-variation-settings:
                'FILL' 0,
                'wght' 200,
                'GRAD' 0,
                'opsz' 24
      }
    </style>

  </head>
  <body>
  <h1>Ear Training</h1>

  <script>
    var numberOfNotes = "1";
    var twoNoteIntervals = [];
//    let TWO_NOTE_INTERVAL_MAP = new Map([["maj2", 2], ["maj3", 4], ["maj4", 5], ["maj5", 7], ["maj6", 9], ["maj7", 11]]);
    let TWO_NOTE_INTERVAL_MAP = new Map([["maj2", 1], ["maj3", 2], ["maj4", 3], ["maj5", 4], ["maj6", 5], ["maj7", 6], ["oct8", 7]]);

    const NOTES = ["c3.mp3", "d3.mp3", "e3.mp3", "f3.mp3", "g3.mp3", "a4.mp3", "b4.mp3", "c4.mp3"];

  </script>
  <fieldset style="width: 33%">
    <legend>Number of notes at a time:</legend>

    <div>
      <input type="radio" id="onenote" name="numberofnotes" value="1" onclick="showOneNoteChordOptions();numberOfNotes = this.value"/>
      <label for="onenote">One</label>
    </div>

    <div>
      <input type="radio" id="twonotes" name="numberofnotes" value="2" onclick="showTwoNoteChordOptions();numberOfNotes = this.value" />
      <label for="twonotes">Two</label>
    </div>

    <div>
      <input type="radio" id="threenotes" name="numberofnotes" value="3" onclick="showThreeNoteChordOptions();numberOfNotes = this.value"/>
      <label for="threenotes">Three</label>
    </div>

    <div>
      <input type="radio" id="fournotes" name="numberofnotes" value="4" onclick="showFourNoteChordOptions();numberOfNotes = this.value"/>
      <label for="fournotes">Four</label>
    </div>

  </fieldset>

  <br/>
  <br/>
  <fieldset style="width: 33%; display: none" id="twoNoteOptionsFieldset">
    <legend>Two note chord options:</legend>

    <div>
      <input type="checkbox" id="minorsecond" name="twonoteoptions" value="min2" />
      <label for="minorsecond">Minor 2nd (1,b2)</label>
    </div>

    <div>
      <input type="checkbox" id="majorsecond" name="twonoteoptions" value="maj2" />
      <label for="majorsecond">Major 2nd (1,2)</label>
    </div>

    <div>
      <input type="checkbox" id="minorthird" name="twonoteoptions" value="min3" />
      <label for="minorthird">Minor 3rd (1,b3)</label>
    </div>

    <div>
      <input type="checkbox" id="majorthird" name="twonoteoptions" value="maj3" />
      <label for="majorthird">Major 3rd (1,3)</label>
    </div>

    <div>
      <input type="checkbox" id="majorfourth" name="twonoteoptions" value="maj4" />
      <label for="majorfourth">Major 4th (1,4)</label>
    </div>

    <div>
      <input type="checkbox" id="majorfifth" name="twonoteoptions" value="maj5" />
      <label for="majorfifth">Major 5th (1,5)</label>
    </div>

    <div>
      <input type="checkbox" id="majorsixth" name="twonoteoptions" value="maj6" />
      <label for="majorsixth">Major 6th (1,6)</label>
    </div>

    <div>
      <input type="checkbox" id="minorseventhtwonotes" name="twonoteoptions" value="min7" />
      <label for="minorseventhtwonotes">Minor 7th (1,b7)</label>
    </div>

    <div>
      <input type="checkbox" id="majorseventhtwonotes" name="twonoteoptions" value="maj7" />
      <label for="majorseventhtwonotes">Major 7th (1,7)</label>
    </div>

    <div>
      <input type="checkbox" id="octavetwonotes" name="twonoteoptions" value="oct8" />
      <label for="octavetwonotes">Octave (1,8)</label>
    </div>


  </fieldset>

  <fieldset style="width: 33%; display: none" id="threeNoteOptionsFieldset">
    <legend>Three note chord options:</legend>

    <div>
      <input type="checkbox" id="majortriad" name="threenoteoptions" value="majortriad" />
      <label for="majortriad">Major Triad (1,3,5)</label>
    </div>

    <div>
      <input type="checkbox" id="minortriad" name="threenoteoptions" value="minortriad" />
      <label for="minortriad">Minor Triad (1,b3,5)</label>
    </div>

    <div>
      <input type="checkbox" id="sus2" name="threenoteoptions" value="sus2triad" />
      <label for="sus2">Sus2 Triad (1,2,5)</label>
    </div>

    <div>
      <input type="checkbox" id="sus4" name="threenoteoptions" value="sus4triad" />
      <label for="sus4">Sus4 Triad (1,4,5)</label>
    </div>

  </fieldset>

  <fieldset style="width: 33%; display: none" id="fourNoteOptionsFieldset">
    <legend>Four note chord options:</legend>

    <div>
      <input type="checkbox" id="dominantseventh" name="fournoteoptions" value="dominantseventh" />
      <label for="dominantseventh">Dominant Seventh (1,3,5,b7)</label>
    </div>

    <div>
      <input type="checkbox" id="majorseventh" name="fournoteoptions" value="majorseventh" />
      <label for="majorseventh">Major Seventh (1,3,5,7)</label>
    </div>

    <div>
      <input type="checkbox" id="ninth" name="fournoteoptions" value="ninth" />
      <label for="ninth">Nineth (1,3,5,9)</label>
    </div>

  </fieldset>

  <script>
    function showOneNoteChordOptions() {
      document.getElementById("twoNoteOptionsFieldset").style.display = "none";
      document.getElementById("threeNoteOptionsFieldset").style.display = "none";
      document.getElementById("fourNoteOptionsFieldset").style.display = "none";
    }

    function showTwoNoteChordOptions() {
      document.getElementById("twoNoteOptionsFieldset").style.display = "";
      document.getElementById("threeNoteOptionsFieldset").style.display = "none";
      document.getElementById("fourNoteOptionsFieldset").style.display = "none";
    }

    function showThreeNoteChordOptions() {
      document.getElementById("twoNoteOptionsFieldset").style.display = "none";
      document.getElementById("threeNoteOptionsFieldset").style.display = "";
      document.getElementById("fourNoteOptionsFieldset").style.display = "none";
    }

    function showFourNoteChordOptions() {
      document.getElementById("twoNoteOptionsFieldset").style.display = "none";
      document.getElementById("threeNoteOptionsFieldset").style.display = "none";
      document.getElementById("fourNoteOptionsFieldset").style.display = "";
    }
  </script>

  <br/>
  <br/>
   <button class="button_icon">

    <span class="material-symbols-outlined" onclick="twoNoteIntervals = findSelectedOptionsForCheckboxName('twonoteoptions');playTwoNoteIntervals();">
      play_circle
    </span>

    <div class="icon_caption">Play</div>
   </button>

  <button class="button_icon">
      <span class="material-symbols-outlined" onclick="playTwoNoteIntervalsAgain();">
        replay
      </span>

    <div class="icon_caption">Play Again</div>

  </button>

  <!--

<button class="button_icon">
  <span class="material-symbols-outlined">
    arrow_forward_ios
  </span>
  <div class="icon_caption">Next</div>

</button>

<button class="button_icon">
  <span class="material-symbols-outlined">
    start
  </span>
  <div class="icon_caption">Start</div>
</button>

<button class="button_icon">
  <span class="material-symbols-outlined" >music_note</span>
  <div class="icon_caption">Solo note</div>
</button>

<button class="button_icon">
  <span class="material-symbols-outlined" >piano</span>
  <div class="icon_caption">Solo note</div>
</button>

<button class="button_icon">
  <span class="material-symbols-outlined" >headphones</span>
  <div class="icon_caption">Solo note</div>
</button>

<button class="button_icon">
  <span class="material-symbols-outlined" >volume_off</span>
  <div class="icon_caption">Solo note</div>
</button>

-->


  <script>

    function stopAll() {
      var children = document.getElementById("audioFiles").children;
      for (var i = 0; i < children.length; i++) {
        var child = children[i];
        child.pause();
        child.currentTime = 0;
      }
    }

    function findSelectedOptionsForCheckboxName(name) {
      var checkboxGroup = document.getElementsByName(name);
      var checked = Array.from(checkboxGroup).filter(
              (checkbox) => checkbox.checked
      ).map((x) => x.value);
      // alert("The Selected options for " + name + " were : " + checked);
      return checked;
    }

    function playTwoNoteIntervals() {
      var currentInterval = getRandomInt(twoNoteIntervals.length);
      var currentOffset = TWO_NOTE_INTERVAL_MAP.get(twoNoteIntervals[currentInterval]);

      // var randomRootNote = getRandomInt(NOTES.length - currentOffset);
      var randomRootNote = 0;
      var secondNote = randomRootNote + currentOffset;

      //remove existing children if any
      const myNode = document.getElementById("audioFiles");
      while (myNode.firstChild) {
        myNode.removeChild(myNode.lastChild);
      }

      var rootNoteNode = document.createElement("audio");
      rootNoteNode.setAttribute("id", "rootNoteNodeId");
      rootNoteNode.setAttribute("src", NOTES[randomRootNote]);
      document.getElementById("audioFiles").appendChild(rootNoteNode);

      var intervalNoteNode = document.createElement("audio");
      intervalNoteNode.setAttribute("id", "intervalNoteNodeId");
      intervalNoteNode.setAttribute("src", NOTES[secondNote]);
      document.getElementById("audioFiles").appendChild(intervalNoteNode);

      document.getElementById("rootNoteNodeId").play();
      document.getElementById("intervalNoteNodeId").play();

      //remove previous track icons
      const node = document.getElementById("audioTrackIcons");
      while (node.firstChild) {
        node.removeChild(node.lastChild);
      }

      //add audio track icons
      addTrackIcon("rootNoteNodeId", NOTES[randomRootNote]);
      addTrackIcon("intervalNoteNodeId", NOTES[secondNote]);

    }

    function addTrackIcon(audioElementId, caption) {
      var track1IconDiv = document.createElement("button");
      track1IconDiv.setAttribute("class", "button_icon");
      track1IconDiv.onclick = function() {stopAll();document.getElementById(audioElementId).play();}
      var track1IconSpan = document.createElement("span");
      track1IconSpan.setAttribute("class", "material-symbols-outlined");
      track1IconSpan.innerText = "headphones";
      track1IconDiv.appendChild(track1IconSpan);
      var track1IconCaption = document.createElement("div");
      track1IconCaption.setAttribute("class", "icon_caption");
      track1IconCaption.innerText = caption;
      track1IconDiv.appendChild(track1IconCaption);
      document.getElementById("audioTrackIcons").appendChild(track1IconDiv);
    }

    function playTwoNoteIntervalsAgain() {
      stopAll();

      var children = document.getElementById("audioFiles").children;
      for (var i = 0; i < children.length; i++) {
        var child = children[i];
        child.play();
      }

    }

    function getRandomInt(max) {
      return Math.floor(Math.random() * max);
    }
  </script>

  <!--  <button id="button" type="button" onclick="document.getElementById('wheatkings').play();document.getElementById('heartofgold').play();">Play music</button>-->

    <span id="audioFiles">
    </span>

    <div id="audioTrackIcons">

    </div>
    <br/>
<!--    <audio id="wheatkings" src="wheatkings.wav"></audio>-->
    <br/>
<!--    <audio id="heartofgold" src="heartofgold.wav"></audio>-->
    <br/>
  </body>
</html>